name: 'Dependabot Auto-Merge on Approval'

on:
    pull_request_review:
        types:
            - submitted

permissions:
    pull-requests: write
    contents: write

jobs:
    automerge:
        runs-on: ubuntu-latest

        # Run only when the PRâ€™s author is Dependabot
        if: github.event.pull_request.user.login == 'dependabot[bot]'

        steps:
            - name: Check if the review is an approval
              id: approval
              run: |
                  if [ "${{ github.event.review.state }}" = "approved" ]; then
                    echo "approved=true" >> $GITHUB_OUTPUT
                  else
                    echo "approved=false" >> $GITHUB_OUTPUT
                  fi

            - name: Enable auto-merge (squash)
              if: steps.approval.outputs.approved == 'true'
              uses: peter-evans/enable-pull-request-automerge@v3
              with:
                  pull-request-number: ${{ github.event.pull_request.number }}
                  merge-method: squash
